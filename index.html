<!DOCTYPE html>
<html>
<head>
    <title>Say Their Names</title>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap" rel="stylesheet">    
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="https://unpkg.com/typewriter-effect@latest/dist/core.js"></script>
    <script src="js/main.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    
</head>
<body>
    <div id="fullpage">
        <div class='section' id='title-section'>
          <div id='title-spacer'></div>
            <h1 id='main-title'>Say Their Names.</h1>
            <div id="title-box"></div>
            
            <script>
              var app = document.getElementById("title-box");
              var typewriter = new Typewriter(app, {
                loop: true,
                delay: 75,
                });
              
                typewriter
                  .pauseFor(2500)
                  .typeString('Justice for Breonna Taylor.')
                  .pauseFor(1000)
                  .deleteChars(15)
                  .pauseFor(100)
                  .typeString('George Floyd.')
                  .pauseFor(1000)
                  .deleteChars(13)
                  .pauseFor(100)
                  .typeString('Ahmaud Arbery.')
                  .pauseFor(1000)
                  .deleteChars(14)
                  .pauseFor(100)
                  .typeString('Elijah McCain.')
                  .pauseFor(1000)
                  .deleteChars(14)
                  .pauseFor(100)
                  .typeString('Black Lives.')
                  .pauseFor(1500)
                  .start();


              // var i = 0;
              // var txt = 'Say Their Names.'
              // var speed = 50

              // function typeWriter() {
              //   console.log("hiii");
              //   if (i < txt.length) {
              //     console.log('hereee');
              //     document.getElementById("main-title").innerHTML += txt.charAt(i);
              //     i ++ ;
              //     setTimeout(typeWriter, speed);
              //   }
              // }
            </script>
            <p id='main-title'></p>
        </div>

        <div class='section' id='map-introduction'>
          <div class='section-spacer'></div>
          <div class='description'>
            <p>Before we examine the topic of police brutality in America, 
              we must pay tribute to those who have lost their lives to 
              police brutality. They are not just statistics, but rather 
              individuals who fell victim to a system riddled with injustice.
              Even though their deaths were a moment in time, the scars
              inflicted upon their communities, their families, their livelihoods,
              will forever remain ingrained in our history.
          </p>
          <p>We must <strong>say their names</strong>.</p>
          </div>

          <div id="map">
            <div id="slider"></div>
            <button id="play-button">Play</button>
              <script>
                  var parseDate = d3.timeParse("%m/%d/%y");
                  var formatDate = d3.timeFormat("%b %Y");
                  var formatDateIntoYear = d3.timeFormat("%Y");

                  var startDate = new Date("2016-01-01"),
                  endDate = new Date("2020-12-01");

                  var margin = {top:0, right:50, bottom:0, left:50},
                    width = 1000 - margin.left - margin.right,
                    height = 600 - margin.top - margin.bottom;
                  
                  var date = new Date("2013-01-01 00:00:00")
                  //console.log()

          
          
                  var projection = d3.geoAlbersUsa().scale(880).translate([width/2, height/2 + 20]);
          
                  var path = d3.geoPath().projection(projection);

                  var svg = d3.select("#map")
                      .append("svg")
                      .attr("width", width + margin.left + margin.right)
                      .attr("height", height + margin.top + margin.bottom);


                  ////////// slider //////////

                  var moving = false;
                  var currentValue = 0;
                  var targetValue = width;

                  var playButton = d3.select("#play-button");
                      
                  var x = d3.scaleTime()
                      .domain([startDate, endDate])
                      .range([0, targetValue])
                      .clamp(true);

                  var slider = svg.append("g")
                      .attr("class", "slider")
                      .attr("transform", "translate(" + margin.left + "," + height/10 + ")");

                  slider.append("line")
                      .attr("class", "track")
                      .attr("x1", x.range()[0])
                      .attr("x2", x.range()[1])
                    .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
                      .attr("class", "track-inset")
                    .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
                      .attr("class", "track-overlay")
                      .call(d3.drag()
                          .on("start.interrupt", function() { slider.interrupt(); })
                          .on("start drag", function() {
                            currentValue = d3.event.x;
                            update(x.invert(currentValue)); 
                          })
                      );

                  slider.insert("g", ".track-overlay")
                      .attr("class", "ticks")
                      .attr("transform", "translate(0," + 18 + ")")
                    .selectAll("text")
                      .data(x.ticks(10))
                      .enter()
                      .append("text")
                      .attr("x", x)
                      .attr("y", 10)
                      .attr("text-anchor", "middle")
                      .text(function(d) { return formatDate(d); });

                  var handle = slider.insert("circle", ".track-overlay")
                      .attr("class", "handle")
                      .attr("r", 9);

                  var label = slider.append("text")  
                      .attr("class", "label")
                      .attr("text-anchor", "middle")
                      .text(formatDate(startDate))
                      .attr("transform", "translate(0," + (-25) + ")")

      
                  ////////// plot //////////
                  
                  var dataset;

                  var plot = svg.append("g")
                          .attr("class", "plot")
                          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


                  d3.json("us.json", function(error, us) {
                    if (error) return console.error(error);
                    plot.append("path")
                    .attr("class", "states")
                    .datum(topojson.feature(us, us.objects.states))
                    .attr("d", path);
                  })

                  //   d3.csv("fatal-encounters.csv")
                  //   .row(function(d) {
                  //     return {
                  //       lat: parseFloat(d.Latitude),
                  //       lng: parseFloat(d.Longitude),
                  //       date: moment(d["Date of injury resulting in death (month/day/year)"], "MM/DD/YYYY").unix(),
                  //       city: d["Location of death (city)"]
                  //     };
                  //   })
                  //   .get(function(err, rows){
                  //     if (err) return console.error(err);
                  //     window.site_data = rows;
                  //   });
                  // });

                  d3.csv("fatal-encounters.csv", prepare, function(data) {
                    dataset = data;
                    drawPlot(dataset);

                    playButton
                      .on("click", function() {
                        var button = d3.select(this);
                        if (button.text() == "Pause") {
                          moving = false;
                          clearInterval(timer);
                          // timer = 0;
                          button.text("Play");
                        } else {
                          moving = true;
                          timer = setInterval(step, 100);
                          button.text("Pause");
                        }
                        console.log("Slider moving: " + moving);
                      })
                  })

                  function prepare(d) {
                    d.lat = parseFloat(d.Latitude);
                    d.lng = parseFloat(d.Longitude);
                    d.date = parseDate(d["Date of injury resulting in death (month/day/year)"]);
                    return d;

                  }

                  function step() {
                    update(x.invert(currentValue));
                    currentValue = currentValue + (targetValue/151);
                    if (currentValue > targetValue) {
                      moving = false;
                      currentValue = 0;
                      clearInterval(timer);
                      // timer = 0;
                      playButton.text("Play");
                      console.log("Slider moving: " + moving);
                    }
                  }

                  function drawPlot(data) {
                  var sites = plot.selectAll(".site")
                    .data(data);
                      
                  sites.enter().append("circle")
                      .attr("class", "site")
                      .attr("cx", function(d) {
                        return projection([d.lng, d.lat])[0];
                      })
                      .attr("cy", function(d) {
                        return projection([d.lng, d.lat])[1];
                      })
                      .style("fill", function(d) { return d3.hsl(69, 0.17, 0.76)})
                      .style("stroke", function(d) { return d3.hsl(69, 0.17, 0.61)})
                      //.style("opacity", 0.5)
                      .attr("r", 4)
                        .transition()
                        .duration(400)
                        .attr("r", 8)
                          .transition()
                          .attr("r", 4);

                  sites.exit()
                      .remove();
                }


                
                function update(h) {
                // update position and text of label according to slider scale
                handle.attr("cx", x(h));
                label
                  .attr("x", x(h))
                  .text(formatDate(h));

                // filter data set and redraw plot
                var newData = dataset.filter(function(d) {
                  return d.date < h;
                })
                drawPlot(newData);
              }


              </script>
          </div>
          
            
        </div>

        <div class='section' id='race'>
          <div class='section-spacer'></div>
          <div class='description'>
            This project examines collected data on police brutality incidents between 2013 and 2019.
          </div>
          <div class='section-spacer'></div>
          <div id='pie-chart'>
            <canvas id="myChart"></canvas>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js"></script>
            
            <script>
                var ctx = document.getElementById("myChart");
                var chartData = {
                    labels: [
                "Black",//Black
                "White", //White
                "Native American", //Native American
                "Asian", //Asian
                "Pacific Islander", //Pacific Islander
                "Hispanic" //Hispanic
              ],
              datasets: [{ //OUTER RING: POPULATION
                data: [0.122996421,
                        0.610651368,
                        0.006613376,
                        0.053784472,
                        0.001626191,
                        0.178127579],
                        backgroundColor: [
                  "#A92D71",
                  "#3A4F6F",
                  "#91ADCF",
                  "#F6C862",
                  "#8DB16E",
                  "#BA7E97"
                ],
                hoverBackgroundColor: [
                  "#792051",
                  "#233043",
                  "#5f88b9",
                  "#f2b226",
                  "#709550",
                  "#a65979"
                ]
              }, { //INNER RING: DEATH
                data: [0.256655738,
                        0.448131148,
                        0.014557377,
                        0.015737705,
                        0.005508197,
                        0.17547541],
                backgroundColor: [
                  "#A92D71",
                  "#3A4F6F",
                  "#91ADCF",
                  "#F6C862",
                  "#8DB16E",
                  "#BA7E97"
                ],
                hoverBackgroundColor: [
                  "#792051",
                  "#233043",
                  "#5f88b9",
                  "#f2b226",
                  "#709550",
                  "#a65979"
                ]
              }]
            };
            var pieChart = new Chart(ctx, {
              type: 'doughnut',
              data: chartData,
              options: {
                cutoutPercentage: 40,
                legend: {
                  position: 'left'
                }
              }
            })
            </script>
            </div>
            <div class='section-spacer'></div>
          <div id='pie-description'>
            
            <div class='description'>
              We first examined the proportion of police brutality incidents on 
              with a racial breakdown. In this graph, the inner ring represents
              the rate at which members of a certain race are killed by police,
              while the outer ring represents the percentage of the population 
              of the corresponding race.
            </div>
            <div class='description'>
              From this, it is evident that Black people are killed at a rate
              that is double the rate of other races, despite being a smaller
              percentage of the population.
            </div>
          </div>
          

        </div>
        <div class='section-spacer'>
        </div>
      <div class='section' id='crime-rate'>
        <div class='section-spacer'></div>
          <h2 class='section-header'>What contributes to high rates of police brutality?</h2>
        <iframe id="igraph" scrolling="no" style="border:none; margin: auto; width: 70%;" seamless="seamless" src="https://plotly.com/~asadsheikh0/1" height="525" width="100%"></iframe>
        <div class='description'>
          Taking a look at the rates of police killings across different cities,
          we examined the violent crime rates in a side-by-side view with the homicide rates.
          From this, we are able to see that there is not an association between violent 
          crime rates and police homicide rates. While we are limited to only exploring associations,
          we must take a look at other factors that influence police killing rates such as police force policies.
        </div>
      </div>

      <div class='section' id='policy'>
        <div class='section-spacer'></div>
        <div class='section-header'>
          <h2>Examining the effects of de-escalation policy</h2>
        </div>
        <div id='policy-graph'>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.1.0/Chart.min.js"></script>

        <div>
            <canvas id="LineWithLine" width="600" height="400" padding="0" margin = "auto" display='block'></canvas>
        </div>

        <script>
        var data = {
            labels: [2015,2016,2017,2018,2019],
            // datasets: [{
            //     data: [12, 3, 2, 1, 8, 8, 2, 2, 3, 5, 7, 1]
            // }]
            datasets: [{ 
                data: [36.57,
                        45.94,
                        22.68,
                        27.91,
                        42.63],
                label: "Denver",
                borderColor: "#3e95cd",
                fill: false
              }, { 
                data: [70.15,
                        50.05,
                        19.89,
                        39.66,
                        26.32],
                label: "Cincinatti",
                borderColor: "#8e5ea2",
                fill: false
              }, { 
                data: [8.45,
                        9.82,
                        5.21,
                        2.97,
                        8.19],
                label: "Dallas",
                borderColor: "#3cba9f",
                fill: false
              }, { 
                data: [10.42,
                        3.44,
                        6.82,
                        5.66,
                        3.40],
                label: "San Francisco",
                borderColor: "#e8c3b9",
                fill: false
              }
            ]
        };

        var ctx = document.getElementById("LineWithLine").getContext("2d");

        Chart.types.Line.extend({
            name: "LineWithLine",
            draw: function () {
                Chart.types.Line.prototype.draw.apply(this, arguments);

                var point = this.datasets[0].points[this.options.lineAtIndex]
                var scale = this.scale

                // draw line
                this.chart.ctx.beginPath();
                this.chart.ctx.moveTo(point.x, scale.startPoint + 24);
                this.chart.ctx.strokeStyle = '#ff0000';
                this.chart.ctx.lineTo(point.x, scale.endPoint);
                this.chart.ctx.stroke();

                // write TODAY
                this.chart.ctx.textAlign = 'center';
                this.chart.ctx.fillText("policy implemented", point.x, scale.startPoint + 12);
            }
        });

        new Chart(ctx).LineWithLine(data, {
            datasetFill : false,
            lineAtIndex: 1
        });
        </script>
        </div>
        <div class='description'>
          There has been a recent push for police departments to offer de-escalation training,
          but how successful has it been in the past? Although we cannot isolate the direct effects
          of de-escalation training given our data, it is still appropriate to examine
          any potential associations. We looked at 4 cities that all implemented de-escalation
          training practices with in their respective police departments, and can see
          a temporary decrease in the rate of police shootings, but it appears as if that
          association does not last long. Are these policies successful, or is the system
          biased in a way in which police officers do not have to face punishment for failure
          to follow the rules?
        </div>
      </div>

      <div style="text-align: center;">
        <div class='section-header'>
          <h2>How many police officers do you think are held accountable 
            for their actions per 100?</h2>
        </div>
        <div id="grids" style="position: relative; margin: 0 auto; overflow: hidden; text-align: center;">
          <div style="margin: auto 1.5em; display: inline-block;">
            <div id="officer_grid" style="float: left; margin-right: 10px;"></div>
            <div id="soln-grid" style="float: right; margin-left: 10px;"><button type="button" onclick="showResults()" id="guess-btn">See actual number</button></div>
          </div>
        </div>
        
        <p class='description'>You guessed <b><span id='guess'>__</span></b> officers.</p>
        <div id='soln-text' style='visibility: hidden' class='description'>
          <p>From 8543 cases between 2013-present, only 1.4% of officers (117) where charged</p>
          <p>Of those only the results of 48 are known; 19 were convicted, 29 were aquitted</p>
        </div>
        <div id="officer_grid"></div>
      </div>

        <div class='section' id='transparency'>
          <div class='section-spacer'></div>
            <h2 class='section-header'>Pushing for Transparency</h2>
            <div class='description'>
              <p>Working with public data, throughout the whole process, we had
                 to be deliberate about how we merged datasets and the type of 
                 connections that we drew from the numbers. The sets of data we 
                 used for this project had many limitations in discovering 
                 causations amongst the many associations. For example, the 
                 lack of transparent police data that examines the effects of 
                 policies on police brutality rates does not allow us to make 
                 any causal assumptions of any relationships between policies 
                 or budgets and police brutality rates. Not only from a data 
                 perspective but also from the perspective of an American 
                 citizen, data transparency would educate our population about 
                 what is actually happening in our country, though limitations 
                 might be caused from system level managements of police 
                 departments. Having done many explorations with data regarding 
                 police brutality and racial equity, we have come to the 
                 conclusion that there is so much vulnerability for justice in 
                 the data because of the lack of detail. At the end of the day, 
                 we need to remember that once an arrest occurs, even if a 
                 report is required, the cops complete that report without a 
                 single word from a possibly innocent arrested person.
            </p>
            </div>
            
        </div>
    </div>

    <script type="text/javascript" src="js/fullpage.js"></script>
    <script type="text/javascript">
	var myFullpage = new fullpage('#fullpage', {
        autoScrolling: false,
        fitToSection: false,
        licenseKey: 'BF32E12A-63184355-9B028F97-1B1558F1',
		    sectionsColor: ['#f2f2f2', '#f2f2f2', '#f2f2f2', 'f2f2f2', '#f2f2f2']
	});
</script>
</body>